"""
Конфигурация раскладов Таро с координатами и параметрами карт
Система координат: рабочая область 512x512 пикселей, центр в (256, 256)
"""
import math

# Размеры исходных карт
CARD_ORIGINAL_WIDTH = 350
CARD_ORIGINAL_HEIGHT = 600

# Размер рабочей области
WORKING_AREA_SIZE = 512
CENTER_X = 256
CENTER_Y = 256

def polar_to_cartesian(radius, angle_degrees, center_x=CENTER_X, center_y=CENTER_Y):
    """Преобразование полярных координат в декартовы"""
    angle_rad = math.radians(angle_degrees)
    x = center_x + radius * math.cos(angle_rad)
    y = center_y + radius * math.sin(angle_rad)
    return (int(x), int(y))

# Конфигурации всех раскладов
LAYOUTS = {
    'single_card': {
        'name': 'На одну карту',
        'card_count': 1,
        'scale': 0.75,  # Крупная карта в центре
        'background_id': 1,
        'positions': [
            {'x': 256, 'y': 256, 'rotation': 0}  # Центр
        ],
        'questions': [
            {
                'id': 'question',
                'text': 'Сформулируйте свой вопрос или опишите ситуацию:',
                'type': 'text'
            }
        ]
    },
    
    'three_cards': {
        'name': 'На три карты',
        'card_count': 3,
        'scale': 0.35,
        'background_id': 2,
        'positions': [
            {'x': 128, 'y': 256, 'rotation': 0},  # Прошлое (слева)
            {'x': 256, 'y': 256, 'rotation': 0},  # Настоящее (центр)
            {'x': 384, 'y': 256, 'rotation': 0},  # Будущее (справа)
        ],
        'card_meanings': [
            'Прошлое - что привело к ситуации',
            'Настоящее - текущее состояние',
            'Будущее - вероятное развитие событий'
        ],
        'questions': [
            {
                'id': 'situation', 
                'text': 'О какой ситуации вы хотите получить прогноз?',
                'type': 'text'
            }
        ]
    },
    
    'celtic_cross': {
        'name': 'Кельтский крест',
        'card_count': 10,
        'scale': 0.25,
        'background_id': 3,
        'positions': [
            # Основной крест
            {'x': 256, 'y': 256, 'rotation': 0},    # 1. Основа ситуации (центр)
            {'x': 256, 'y': 256, 'rotation': 90},   # 2. Влияние/препятствие (поверх №1)
            {'x': 256, 'y': 180, 'rotation': 0},    # 3. То, что над (сверху)
            {'x': 332, 'y': 256, 'rotation': 0},    # 4. Будущее (справа)
            {'x': 256, 'y': 332, 'rotation': 0},    # 5. Подсознание (снизу)
            {'x': 180, 'y': 256, 'rotation': 0},    # 6. Прошлое (слева)
            
            # Башня справа
            {'x': 400, 'y': 350, 'rotation': 0},    # 7. Ваше влияние
            {'x': 400, 'y': 290, 'rotation': 0},    # 8. Внешнее влияние
            {'x': 400, 'y': 230, 'rotation': 0},    # 9. Надежды и страхи
            {'x': 400, 'y': 170, 'rotation': 0},    # 10. Итог/результат
        ],
        'card_meanings': [
            'Тема/Основа - суть ситуации',
            'Влияние/Препятствие - что воздействует на ситуацию', 
            'Внешние обстоятельства - неучтённые факторы',
            'Ближайшее будущее - вероятное развитие',
            'Подсознание - скрытые мотивы и чувства',
            'Недавнее прошлое - что привело к ситуации',
            'Ваш подход - как вы влияете на ситуацию',
            'Внешние влияния - окружение и обстоятельства',
            'Надежды и страхи - ожидания от ситуации',
            'Итог - к чему всё приведёт'
        ],
        'questions': [
            {
                'id': 'main_question',
                'text': 'Опишите ситуацию, которую хотите проанализировать:',
                'type': 'text'
            },
            {
                'id': 'focus_area',
                'text': 'На какой аспект обратить особое внимание?',
                'type': 'choice',
                'options': ['Отношения', 'Карьера', 'Финансы', 'Личностный рост', 'Здоровье']
            }
        ]
    },
    
    'horseshoe': {
        'name': 'Подкова',
        'card_count': 7,
        'scale': 0.28,
        'background_id': 4,
        'positions': [
            {'x': 150, 'y': 320, 'rotation': -30},  # 1. Прошлое
            {'x': 180, 'y': 240, 'rotation': -15},  # 2. Настоящее
            {'x': 230, 'y': 180, 'rotation': 0},    # 3. Будущее
            {'x': 256, 'y': 150, 'rotation': 0},    # 4. Ваш подход
            {'x': 282, 'y': 180, 'rotation': 0},    # 5. Внешние влияния
            {'x': 332, 'y': 240, 'rotation': 15},   # 6. Препятствия
            {'x': 362, 'y': 320, 'rotation': 30},   # 7. Итог
        ],
        'card_meanings': [
            'Прошлое - основа ситуации',
            'Настоящее - текущие обстоятельства',
            'Скрытые влияния - что не видно на поверхности',
            'Ваш подход - как действовать',
            'Внешние факторы - окружение',
            'Препятствия - что мешает',
            'Вероятный исход - итог'
        ],
        'questions': [
            {
                'id': 'goal',
                'text': 'К какой цели вы стремитесь?',
                'type': 'text'
            }
        ]
    },
    
    'love_triangle': {
        'name': 'Любовный треугольник', 
        'card_count': 6,
        'scale': 0.30,
        'background_id': 5,
        'positions': [
            {'x': 256, 'y': 140, 'rotation': 0},    # 1. Вы (вершина треугольника)
            {'x': 160, 'y': 300, 'rotation': 0},    # 2. Партнёр/Возлюбленный (левый угол)
            {'x': 352, 'y': 300, 'rotation': 0},    # 3. Ситуация/Третья сторона (правый угол)
            {'x': 208, 'y': 220, 'rotation': 0},    # 4. Чувства между вами и партнёром
            {'x': 304, 'y': 220, 'rotation': 0},    # 5. Внешние влияния на отношения
            {'x': 256, 'y': 360, 'rotation': 0},    # 6. Исход отношений
        ],
        'card_meanings': [
            'Вы - ваше состояние и чувства',
            'Партнёр - его состояние и намерения',
            'Ситуация - что влияет на отношения',
            'Связь между вами - динамика отношений',
            'Внешние влияния - окружение, обстоятельства',
            'Перспективы - развитие отношений'
        ],
        'questions': [
            {
                'id': 'relationship_type',
                'text': 'О каких отношениях вы хотите узнать?',
                'type': 'choice',
                'options': ['Новые отношения', 'Текущие отношения', 'Выбор между партнёрами', 'Восстановление отношений']
            },
            {
                'id': 'specific_question',
                'text': 'Что именно вас волнует в этих отношениях?',
                'type': 'text'
            }
        ]
    },
    
    'week_forecast': {
        'name': 'Прогноз на неделю',
        'card_count': 7,
        'scale': 0.25,
        'background_id': 6,
        'positions': [
            {'x': 120, 'y': 180, 'rotation': 0},    # Понедельник
            {'x': 180, 'y': 180, 'rotation': 0},    # Вторник
            {'x': 240, 'y': 180, 'rotation': 0},    # Среда
            {'x': 300, 'y': 180, 'rotation': 0},    # Четверг
            {'x': 360, 'y': 180, 'rotation': 0},    # Пятница
            {'x': 210, 'y': 280, 'rotation': 0},    # Суббота
            {'x': 300, 'y': 280, 'rotation': 0},    # Воскресенье
        ],
        'card_meanings': [
            'Понедельник - начало недели, новые возможности',
            'Вторник - развитие планов, действия',
            'Среда - середина недели, кульминация',
            'Четверг - завершение дел, подведение итогов',
            'Пятница - окончание рабочего периода',
            'Суббота - отдых, личное время',
            'Воскресенье - подготовка к новой неделе'
        ],
        'questions': [
            {
                'id': 'week_focus',
                'text': 'На что хотите обратить внимание на предстоящей неделе?',
                'type': 'choice',
                'options': ['Работа и карьера', 'Личные отношения', 'Здоровье', 'Финансы', 'Общий прогноз']
            }
        ]
    },
    
    'year_wheel': {
        'name': 'Колесо года',
        'card_count': 12,
        'scale': 0.22,
        'background_id': 7,
        'positions': [
            # Карты размещаются по кругу, начиная с "12 часов" против часовой стрелки
            polar_to_cartesian(180, -90),   # 1. Январь/1-й дом (12 часов)
            polar_to_cartesian(180, -60),   # 2. Февраль/2-й дом (1 час)
            polar_to_cartesian(180, -30),   # 3. Март/3-й дом (2 часа)
            polar_to_cartesian(180, 0),     # 4. Апрель/4-й дом (3 часа)
            polar_to_cartesian(180, 30),    # 5. Май/5-й дом (4 часа)
            polar_to_cartesian(180, 60),    # 6. Июнь/6-й дом (5 часов)
            polar_to_cartesian(180, 90),    # 7. Июль/7-й дом (6 часов)
            polar_to_cartesian(180, 120),   # 8. Август/8-й дом (7 часов)
            polar_to_cartesian(180, 150),   # 9. Сентябрь/9-й дом (8 часов)
            polar_to_cartesian(180, 180),   # 10. Октябрь/10-й дом (9 часов)
            polar_to_cartesian(180, 210),   # 11. Ноябрь/11-й дом (10 часов)
            polar_to_cartesian(180, 240),   # 12. Декабрь/12-й дом (11 часов)
        ],
        'card_meanings': [
            '1-й дом - Личность, характер, внешность',
            '2-й дом - Деньги, материальные ресурсы', 
            '3-й дом - Общение, обучение, ближайшее окружение',
            '4-й дом - Дом, семья, корни, недвижимость',
            '5-й дом - Творчество, любовь, дети, хобби',
            '6-й дом - Здоровье, работа, повседневная рутина',
            '7-й дом - Партнёрство, брак, открытые враги',
            '8-й дом - Трансформации, кризисы, чужие деньги',
            '9-й дом - Мировоззрение, путешествия, высшее образование',
            '10-й дом - Карьера, репутация, статус в обществе',
            '11-й дом - Друзья, надежды, социальные группы',
            '12-й дом - Тайны, подсознание, скрытые враги'
        ],
        'questions': [
            {
                'id': 'time_period',
                'text': 'На какой период хотите получить прогноз?',
                'type': 'choice',
                'options': ['На год вперёд', 'Анализ текущего года', 'По месяцам', 'По сферам жизни']
            },
            {
                'id': 'focus_areas',
                'text': 'Какие сферы жизни вас больше всего интересуют?',
                'type': 'text'
            }
        ]
    }
}

# Преобразуем полярные координаты в обычные для year_wheel
year_wheel_positions = []
for i in range(12):
    angle = -90 + i * 30  # Начинаем с -90° (12 часов), по часовой стрелке
    pos = polar_to_cartesian(180, angle)
    year_wheel_positions.append({'x': pos[0], 'y': pos[1], 'rotation': 0})

LAYOUTS['year_wheel']['positions'] = year_wheel_positions

# Функция для получения конфигурации расклада
def get_spread_config(spread_type):
    """Получить конфигурацию расклада по типу"""
    return LAYOUTS.get(spread_type)

# Функция для получения всех доступных раскладов
def get_all_spreads():
    """Получить список всех доступных раскладов"""
    return {key: value['name'] for key, value in LAYOUTS.items()}

# Функция валидации координат
def validate_position(x, y, card_width, card_height):
    """Проверить, помещается ли карта в рабочую область"""
    half_width = card_width // 2
    half_height = card_height // 2
    
    return (half_width <= x <= WORKING_AREA_SIZE - half_width and
            half_height <= y <= WORKING_AREA_SIZE - half_height)

# Функция для расчёта размеров карты с учётом масштаба
def get_card_dimensions(scale):
    """Получить размеры карты с учётом масштабирования"""
    width = int(CARD_ORIGINAL_WIDTH * scale)
    height = int(CARD_ORIGINAL_HEIGHT * scale)
    return width, height
